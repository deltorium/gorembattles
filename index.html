<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GOREM OS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main: #00ff88; --bg: #0f0f13; --card: #1e1e24; --text: #fff; --danger: #ff4444; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; padding-bottom: 70px; }
        
        .header { padding: 15px; background: linear-gradient(180deg, rgba(0,255,136,0.1), transparent); text-align: center; border-bottom: 1px solid #333; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--main); margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 24px; background: #333; }
        .balance { font-size: 24px; font-weight: bold; margin: 5px 0; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .card-box { background: var(--card); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #333; cursor: pointer; }
        .btn { width: 100%; padding: 10px; background: var(--main); border: none; border-radius: 8px; font-weight: bold; margin-top: 5px; cursor: pointer; color: black; }
        .btn-red { background: var(--danger); color: white; }
        .btn-blue { background: #00aaff; color: white; }

        .tab-bar { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #333; z-index: 100; overflow-x: auto; }
        .tab-btn { background: none; border: none; font-size: 20px; cursor: pointer; opacity: 0.5; padding: 0 10px; }
        .tab-btn.active { opacity: 1; transform: scale(1.2); color: var(--main); }

        .page { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* DECODE STYLE */
        #decode .card-box { border-color: var(--main); font-family: monospace; }
        .glitch { animation: glitch 1s infinite; }
        @keyframes glitch { 0% { transform: translate(0) } 20% { transform: translate(-2px, 2px) } 40% { transform: translate(-2px, -2px) } 60% { transform: translate(2px, 2px) } 80% { transform: translate(2px, -2px) } 100% { transform: translate(0) } }

        /* ADMIN PANEL */
        .admin-panel { border: 1px solid var(--danger); padding: 10px; border-radius: 10px; background: rgba(255,0,0,0.1); }
        .admin-title { color: var(--danger); text-align: center; text-transform: uppercase; margin-bottom: 10px; }
        
        /* CHAT & INV */
        #chat-list { height: 60vh; overflow-y: auto; margin-bottom: 50px; padding: 5px; display: flex; flex-direction: column-reverse; }
        .msg { margin-bottom: 8px; padding: 8px; background: #222; border-radius: 8px; font-size: 13px; }
        .msg-name { font-weight: bold; color: var(--main); font-size: 11px; }
        
        .inv-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .inv-card { background: #222; border-radius: 5px; cursor: pointer; position: relative; aspect-ratio: 2/3; overflow: hidden; }
        .inv-card img { width: 100%; height: 100%; object-fit: cover; }
        
        input { width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; margin-bottom: 10px; box-sizing: border-box; }
        
        #modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); z-index: 999; display: none; justify-content: center; align-items: center; flex-direction: column; }
        #modal img { width: 200px; border: 2px solid var(--main); border-radius: 10px; }
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 30px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="loader" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:1000; display:flex; justify-content:center; align-items:center;">Connecting...</div>

    <div class="header">
        <div class="avatar" id="u-ava"></div>
        <div id="u-name" style="margin-top:5px; font-weight:bold;">User</div>
        <div class="balance"><span id="u-bal">0</span> ğŸª™</div>
        <div style="font-size:12px; color:#aaa;">ID: <span id="u-id"></span></div>
    </div>

    <!-- HOME -->
    <div id="home" class="page active">
        <h3>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</h3>
        <button class="btn" onclick="api('farm')">â›ï¸ Ğ¤ĞĞ Ğœ (+100)</button>
        <button class="btn" onclick="location.href='game.html'" style="margin-top:10px; background:#aa00ff; color:white;">âš”ï¸ Ğ˜Ğ“Ğ ĞĞ¢Ğ¬</button>
        
        <h3>Ğ˜Ğ³Ñ€Ñ‹</h3>
        <div class="grid">
            <div class="card-box" onclick="nav('decode', document.getElementById('btn-decode'))">ğŸ’» Ğ”ĞµĞºĞ¾Ğ´ĞµÑ€</div>
            <div class="card-box" onclick="nav('events', document.getElementById('btn-events'))">ğŸ Ğ˜Ğ²ĞµĞ½Ñ‚Ñ‹</div>
        </div>

        <h3>ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</h3>
        <div class="grid">
            <div class="card-box"><div>Ğ’Ğ°Ğ¹Ğ¿Ñ‹</div><h2 id="u-wipes">0</h2></div>
            <div class="card-box"><div>ĞšĞ°Ñ€Ñ‚Ñ‹</div><h2 id="u-cards">0</h2></div>
        </div>
        <input type="text" id="promo-code" placeholder="ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´">
        <button class="btn" onclick="usePromo()">OK</button>
    </div>

    <!-- DECODE -->
    <div id="decode" class="page">
        <h2 style="color:var(--main); font-family:monospace;">> DECODER_V2.0</h2>
        <div class="grid">
            <div class="card-box" onclick="doDecode('x2')">ğŸ“ˆ x2 MTC<br><small>Ğ¨Ğ°Ğ½Ñ 40%</small></div>
            <div class="card-box" onclick="doDecode('crash')">ğŸ“‰ CRASH<br><small>ĞĞ±Ğ²Ğ°Ğ» Ñ€Ñ‹Ğ½ĞºĞ°</small></div>
            <div class="card-box" onclick="doDecode('gift')">ğŸ GIFT<br><small>Ğ’Ğ·Ğ»Ğ¾Ğ¼ Ğ¿Ğ¾Ğ´Ğ°Ñ€ĞºĞ°</small></div>
        </div>
        <div id="decode-log" style="font-family:monospace; color:#aaa; margin-top:20px;">ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ...</div>
    </div>

    <!-- EVENTS -->
    <div id="events" class="page">
        <div id="event-box" class="card-box" style="padding:30px;">
            <h1 id="event-title">Ğ¢Ğ¸ÑˆĞ¸Ğ½Ğ°...</h1>
            <p id="event-desc">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¸Ğ²ĞµĞ½Ñ‚Ğ¾Ğ² Ğ½ĞµÑ‚.</p>
            <div id="boss-hp" style="display:none; color:red; font-weight:bold; font-size:24px;"></div>
            <button id="event-btn" class="btn hidden" onclick="eventAction()">Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ•</button>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="admin" class="page">
        <div class="admin-panel">
            <div class="admin-title">ğŸ‘‘ ADMIN PANEL</div>
            <input type="number" id="adm-id" placeholder="Target User ID">
            <input type="number" id="adm-amount" placeholder="Amount">
            <div class="grid">
                <button class="btn" onclick="adm('give_coins')">Give Coins</button>
                <button class="btn btn-red" onclick="adm('wipe_user')">WIPE</button>
            </div>
            <hr style="border-color:#444">
            <input type="text" id="adm-promo" placeholder="Promo Code">
            <button class="btn" onclick="adm('create_promo')">Create Promo</button>
            <hr style="border-color:#444">
            <h3>Events</h3>
            <div class="grid">
                <button class="btn btn-red" onclick="adm('trigger_event', {event_type: 'boss'})">Start Boss</button>
                <button class="btn" onclick="adm('trigger_event', {event_type: 'gift'})">Start Gift</button>
                <button class="btn" onclick="adm('stop_event')">Stop All</button>
            </div>
        </div>
    </div>

    <!-- CHAT -->
    <div id="chat" class="page" style="padding:0;">
        <div id="chat-list"></div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ...">
            <button class="btn" style="width:auto; margin:0 0 0 5px;" onclick="sendChat()">â¤</button>
        </div>
    </div>

    <!-- SHOP, CRYPTO, FIRM, TOP, INV (Standard) -->
    <!-- (ĞÑÑ‚Ğ°Ğ²Ğ¸Ğ» Ğ¸Ñ… ÑĞ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸, ĞºĞ¾Ğ´ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ‡ĞµĞ½ v7.0, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºĞ¸ ÑÑĞ´Ğ°) -->
    <!-- ... SHOP, CRYPTO, FIRM, TOP, INV BLOCKS HERE ... -->
    <div id="shop" class="page"><h3>ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</h3><div class="grid"><div class="card-box" onclick="buy('common', 50)">ğŸ“¦ Common<br>50</div><div class="card-box" onclick="buy('rare', 150)">ğŸŸ¦ Rare<br>150</div><div class="card-box" onclick="buy('premium', 300)">ğŸŸª Premium<br>300</div><div class="card-box" onclick="buy('mythic', 1000)">ğŸŸ§ Mythic<br>1000</div><div class="card-box" onclick="buy('secret', 5000)">â¬› Secret<br>5000</div><div class="card-box" onclick="buy('platinum', 500000)">ğŸ‘‘ Platinum<br>500k</div></div></div>
    <div id="crypto" class="page"><h3>Ğ‘Ğ¸Ñ€Ğ¶Ğ°</h3><h1 style="text-align:center">ğŸ’ <span id="mtc-price">0</span></h1><canvas id="chart"></canvas><input type="number" id="trade-amount" placeholder="Ğ¡ÑƒĞ¼Ğ¼Ğ°"><div class="grid"><button class="btn" onclick="trade('buy')">BUY</button><button class="btn btn-red" onclick="trade('sell')">SELL</button></div></div>
    <div id="firm" class="page"><div id="firm-none"><input id="new-firm-name" placeholder="Name"><button class="btn" onclick="firmAction('create')">Create (100k)</button><input id="join-id" placeholder="ID"><button class="btn" onclick="firmAction('join')">Join</button></div><div id="firm-exists" style="display:none"><h2 id="firm-name"></h2><button class="btn" onclick="firmAction('donate')">Donate</button></div></div>
    <div id="top" class="page"><h3>TOP 10</h3><div id="top-list"></div></div>
    <div id="inv" class="page"><div class="inv-grid" id="inv-grid"></div></div>

    <!-- TAB BAR -->
    <div class="tab-bar">
        <button class="tab-btn active" onclick="nav('home', this)">ğŸ </button>
        <button class="tab-btn" onclick="nav('chat', this)">ğŸ’¬</button>
        <button class="tab-btn" onclick="nav('shop', this)">ğŸ›’</button>
        <button class="tab-btn" onclick="nav('crypto', this)">ğŸ“ˆ</button>
        <button class="tab-btn" onclick="nav('firm', this)">ğŸ¢</button>
        <button class="tab-btn" id="btn-decode" onclick="nav('decode', this)">ğŸ’»</button>
        <button class="tab-btn" id="btn-events" onclick="nav('events', this)">ğŸ</button>
        <button class="tab-btn" id="btn-admin" style="display:none; color:red;" onclick="nav('admin', this)">ğŸ‘‘</button>
        <button class="tab-btn" onclick="nav('inv', this)">ğŸ’</button>
    </div>

    <div id="modal"><div class="close-modal" onclick="document.getElementById('modal').style.display='none'">âœ–</div><img id="m-img"><h2 id="m-name"></h2><p id="m-desc"></p><div id="m-rarity"></div></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // !!! Ğ—ĞĞœĞ•ĞĞ˜ ĞĞ Ğ¡Ğ’ĞĞ™ !!!
        const API_URL = "https://my-super-bot-1gwh.onrender.com"; 

        let user = tg.initDataUnsafe?.user || { id: 7328565195, first_name: "Test", username: "test" };
        let appData = {};
        let chartInstance = null;

        async function init() {
            try {
                document.getElementById('u-ava').innerText = user.first_name[0];
                const res = await fetch(`${API_URL}/api/get_user`, {
                    method: 'POST',
                    body: JSON.stringify({ user_id: user.id, first_name: user.first_name })
                });
                appData = await res.json();
                render();
                document.getElementById('loader').style.display = 'none';
                
                // Show Admin Tab
                if (appData.is_admin) document.getElementById('btn-admin').style.display = 'block';

            } catch(e) { alert("Error: " + e); }
        }

        function render() {
            document.getElementById('u-name').innerText = appData.user.first_name;
            document.getElementById('u-id').innerText = appData.user.user_id;
            document.getElementById('u-bal').innerText = appData.user.balance;
            document.getElementById('u-crypto').innerText = appData.user.crypto_balance;
            document.getElementById('u-wipes').innerText = appData.user.wipe_count || 0;
            
            // Inventory
            let totalCards = 0;
            const invDiv = document.getElementById('inv-grid');
            invDiv.innerHTML = "";
            appData.inventory.forEach(c => {
                totalCards += c.count;
                invDiv.innerHTML += `<div class="inv-card" onclick='showCard(${JSON.stringify(c)})'><img src="${c.image_url}"><div class="inv-count">x${c.count}</div></div>`;
            });
            document.getElementById('u-cards').innerText = totalCards;

            // Crypto & Firm (Standard render)
            document.getElementById('mtc-price').innerText = appData.crypto.price;
            drawChart(appData.crypto.history);
            
            if (appData.firm) {
                document.getElementById('firm-exists').style.display = 'block';
                document.getElementById('firm-none').style.display = 'none';
                document.getElementById('firm-name').innerText = appData.firm.name;
                document.getElementById('firm-bal').innerText = appData.firm.balance;
            }

            // Events
            const ev = appData.event;
            const evBox = document.getElementById('event-box');
            const evBtn = document.getElementById('event-btn');
            
            if (ev.active) {
                evBtn.classList.remove('hidden');
                if (ev.type === 'boss') {
                    document.getElementById('event-title').innerText = "âš”ï¸ Ğ‘ĞĞ¡Ğ¡: ĞĞ›Ğ•ĞšĞ¡Ğ•Ğ™";
                    document.getElementById('event-desc').innerText = `HP: ${ev.boss_hp} / ${ev.boss_max}`;
                    evBtn.innerText = "ĞĞ¢ĞĞšĞĞ’ĞĞ¢Ğ¬";
                } else {
                    document.getElementById('event-title').innerText = "ğŸ ĞŸĞĞ”ĞĞ ĞĞš";
                    document.getElementById('event-desc').innerText = "ĞšÑ‚Ğ¾-Ñ‚Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ» ĞºĞ¾Ñ€Ğ¾Ğ±ĞºÑƒ...";
                    evBtn.innerText = "ĞĞ¢ĞšĞ Ğ«Ğ¢Ğ¬";
                }
            } else {
                document.getElementById('event-title').innerText = "Ğ¢Ğ¸ÑˆĞ¸Ğ½Ğ°...";
                document.getElementById('event-desc').innerText = "Ğ˜Ğ²ĞµĞ½Ñ‚Ğ¾Ğ² Ğ½ĞµÑ‚.";
                evBtn.classList.add('hidden');
            }
        }

        async function api(endpoint, payload={}) {
            tg.MainButton.showProgress();
            payload.user_id = user.id;
            try {
                const res = await fetch(`${API_URL}/api/${endpoint}`, { method: 'POST', body: JSON.stringify(payload) });
                const data = await res.json();
                tg.MainButton.hideProgress();
                if (data.success) {
                    if (data.msg) tg.showAlert(data.msg);
                    if (data.card) showCard(data.card);
                    init();
                } else { tg.showAlert(data.msg || "ĞÑˆĞ¸Ğ±ĞºĞ°"); }
            } catch(e) { tg.MainButton.hideProgress(); alert(e); }
        }

        // --- NEW FUNCTIONS ---
        function doDecode(target) {
            document.getElementById('decode-log').innerText = "Ğ’Ğ·Ğ»Ğ¾Ğ¼...";
            setTimeout(() => { api('decode', { target: target }); }, 1000);
        }

        function eventAction() { api('event_interact'); }

        function adm(act, extra={}) {
            const payload = { act: act, ...extra };
            if (act === 'give_coins' || act === 'wipe_user') {
                payload.target_id = document.getElementById('adm-id').value;
                payload.amount = document.getElementById('adm-amount').value;
            }
            if (act === 'create_promo') {
                payload.code = document.getElementById('adm-promo').value;
                payload.amount = document.getElementById('adm-amount').value;
            }
            api('admin', payload);
        }

        // --- STANDARD FUNCTIONS (Chat, Nav, etc) ---
        // (Copy from v7.0 or use previous logic)
        async function loadChat() {
            const res = await fetch(`${API_URL}/api/chat_get`, { method: 'POST', body: JSON.stringify({ user_id: user.id }) });
            const data = await res.json();
            const list = document.getElementById('chat-list');
            list.innerHTML = "";
            data.messages.forEach(m => {
                const cls = m.is_system ? 'msg system' : 'msg';
                list.innerHTML += `<div class="${cls}"><span class="msg-name">${m.username}</span>: ${m.message}</div>`;
            });
        }
        function sendChat() {
            const msg = document.getElementById('chat-input').value;
            if(msg) {
                document.getElementById('chat-input').value = "";
                fetch(`${API_URL}/api/chat_send`, { method: 'POST', body: JSON.stringify({ user_id: user.id, name: user.first_name, message: msg }) }).then(loadChat);
            }
        }
        
        function buy(type, price) { tg.showConfirm(`ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ ${type}?`, (ok) => { if(ok) api('buy_case', { type: type }); }); }
        function trade(op) { const val = document.getElementById('trade-amount').value; if(val) api('crypto_trade', { op: op, amount: val }); }
        function usePromo() { const code = document.getElementById('promo-code').value; if(code) api('promo', { code: code }); }
        function firmAction(act) {
            const payload = { act: act };
            if (act === 'create') payload.name = document.getElementById('new-firm-name').value;
            if (act === 'join') payload.fid = document.getElementById('join-id').value;
            if (act === 'donate') payload.amount = document.getElementById('donate-amount').value;
            api('firm', payload);
        }

        function nav(id, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
            if(id === 'chat') loadChat();
            if(id === 'top') loadTop();
        }
        
        function showCard(c) {
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('m-img').src = c.image_url;
            document.getElementById('m-name').innerText = c.name;
            document.getElementById('m-desc').innerText = c.description || "";
            document.getElementById('m-rarity').innerText = c.rarity.toUpperCase();
        }

        async function loadTop() {
            const res = await fetch(`${API_URL}/api/top`, { method: 'POST', body: JSON.stringify({user_id: user.id}) });
            const data = await res.json();
            const list = document.getElementById('top-list');
            list.innerHTML = "";
            data.top.forEach((u, i) => { list.innerHTML += `<div class="list-item"><div>${i+1}. ${u.first_name}</div><div style="color:gold">${u.balance}</div></div>`; });
        }
        async function loadFirmsList() { document.getElementById('firm-list').innerText = "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ID Ñ„Ğ¸Ñ€Ğ¼Ñ‹"; }
        
        function drawChart(data) {
            const ctx = document.getElementById('chart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: data.map((_, i) => i), datasets: [{ label: 'MTC', data: data, borderColor: '#00aaff', borderWidth: 2, pointRadius: 0, fill: true, backgroundColor: 'rgba(0, 170, 255, 0.1)' }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { ticks: { color: '#666' }, grid: { color: '#333' } } } }
            });
        }

        init();
    </script>
</body>
</html>
